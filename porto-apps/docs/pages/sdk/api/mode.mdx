# Mode

## Built-in Modes

| Mode | Uses | Best for |
|------|------|----------|
| `Mode.dialog` (default)    | Hosted Porto Dialog | Applications |
| `Mode.relay` | Direct to Relay | Wallets or Account Managers |

## Mode.dialog

Dialog mode embeds the hosted Porto Dialog (an iframe pointing to `id.porto.sh`) and forwards every request that requires user interaction to that dialog.

### Diagram

In the diagram below, `Mode.dialog` is utilized within the Application to communicate with the Porto Dialog (`id.porto.sh`).

<img alt="Mode.dialog" className="dark:hidden" src="/mode-dialog-light.svg" />
<img alt="Mode.dialog" className="hidden dark:block" src="/mode-dialog-dark.svg" />

### Usage

```ts twoslash
import { Porto, Mode } from 'porto'

const porto = Porto.create({
  mode: Mode.dialog(), // [!code focus]
})
```

### Options

#### fallback

- **Type**: `Mode.Mode`
- **Default**: `Mode.relay()`

Mode to fall back to if the renderer does not support background operations (e.g. popups and web views).

#### host

- **Type**: `string`
- **Default**: `"https://id.porto.sh/dialog"`

URL of the dialog embed.

:::tip
While the application uses `Mode.dialog` to communicate to the Dialog, the dialog host (e.g. `https://id.porto.sh/dialog`) utilizes the `Mode.relay` mode to [communicate](#diagram-1) with the Relay.
:::

```ts twoslash
import { Porto, Mode } from 'porto'

const porto = Porto.create({
  mode: Mode.dialog({
    host: 'https://account.my-wallet.com/dialog', // [!code focus]
  }),
})
```

#### renderer

- **Type**: `Dialog.Dialog`
- **Default**: `Dialog.iframe()`

The [renderer](/sdk/api/dialog) to use for the dialog. Available: [`Dialog.iframe`](/sdk/api/dialog#dialogiframe), [`Dialog.popup`](/sdk/api/dialog#dialogpopup)

```ts twoslash
import { Dialog, Porto, Mode } from 'porto'

const porto = Porto.create({
  mode: Mode.dialog({
    renderer: Dialog.popup(), // [!code focus]
  }),
})
```

#### theme

- **Type**: `ThemeFragment | undefined`

A custom theme to apply to the dialog, where only `colorScheme` is required. See the [Theme](/sdk/api/theme) API for the list of styling properties that can be defined.

#### themeController

- **Type**: `Dialog.ThemeController | undefined`

A controller to manage the dialog theme, created by `Dialog.createThemeController()`. It can be used to change the theme of the dialog without reinitializing it, with `themeController.setTheme()`. This is intended for advanced use cases, `theme` should be sufficient in regular scenarios.

## Mode.relay

Interacts with the **Porto Relay** directly. Signing is performed via the SDK. Account management, chain interop, and transaction management is orchestrated on the Relay.

:::tip

The `Mode.relay` mode is used internally by the Porto Dialog (`id.porto.sh`). It is possible
for Wallet vendors to use `Mode.relay` to create their own Dialog.

:::

### Diagram

In the diagram below, `Mode.relay` is utilized within the Porto Dialog (`id.porto.sh`) to communicate with the Relay.

<img alt="Mode.relay" className="dark:hidden" src="/mode-relay-light.svg" />
<img alt="Mode.relay" className="hidden dark:block" src="/mode-relay-dark.svg" />

### Usage

```ts twoslash
import { Porto, Mode } from 'porto'

const porto = Porto.create({
  mode: Mode.relay(), // [!code focus]
})
```

### Caveats

- When you run `Mode.relay` the Passkey Host (WebAuthn Relying Party) becomes **your domain**, not `id.porto.sh`. Credentials created here cannot be asserted on other domains, which means **users cannot reuse their Porto account** created on `id.porto.sh`.

### Options

#### keystoreHost

- **Type**: `string`
- **Default**: `"self"`

Keystore host (WebAuthn relying party).

```ts twoslash
import { Porto, Mode } from 'porto'

const porto = Porto.create({
  mode: Mode.relay({
    keystoreHost: 'https://account.my-wallet.com', // [!code focus]
  }),
})
```

#### webAuthn

#### webAuthn.createFn

- **Type**: `WebAuthnP256.createCredential.Options['createFn']`

WebAuthn create credential function. Defaults to `navigator.credentials.create`.

:::tip
You can override this with a custom implementation of the WebAuthn API.
For example, you can use [`react-native-passkeys`](https://github.com/peterferguson/react-native-passkeys) for React Native.
:::

#### webAuthn.getFn

- **Type**: `WebAuthnP256.sign.Options['getFn']`

WebAuthn get credential function. Defaults to `navigator.credentials.get`.

:::tip
You can override this with a custom implementation of the WebAuthn API.
For example, you can use [`react-native-passkeys`](https://github.com/peterferguson/react-native-passkeys) for React Native.
:::
