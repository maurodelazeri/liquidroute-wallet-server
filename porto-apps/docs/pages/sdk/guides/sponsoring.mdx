import { Example } from '../../../components/guides/Siwe'
import { GuideDemoContainer } from '../../../components/GuideDemoContainer'

# Fee Sponsoring

This guide will demonstrate how you can leverage Fee Sponsoring in your Application to cover
fees for your users.

## Template

We will base this guide off the following template:

```bash
pnpx gitpick ithacaxyz/porto/tree/main/examples/sponsoring-vite
```

:::note
We also have a [Next.js](https://nextjs.org) example at:

```bash
pnpx gitpick ithacaxyz/porto/tree/main/examples/sponsoring-next.js
```

:::

## Steps

::::steps

### Connect Account

Follow the [Onboard & Discover Accounts](/sdk/guides/discover-accounts) guide to get this set up.

### Set up Merchant Account

Run the following command to onboard a new Porto Merchant (Sponsor) Account.

```sh
pnpx porto onboard --admin-key --testnet
```

Place the address and private key of the merchant account into the `.env` file.

```sh
MERCHANT_ADDRESS=0x...
MERCHANT_PRIVATE_KEY=0x...
```

### Set up Merchant API Route

Next, we will set up our [Merchant API Route](/sdk/api/route/merchant) at a `/porto/merchant` endpoint.

For this example, we will use a Cloudflare Worker, however, you could also use a
server framework of your choice (Next.js, Deno, Express, etc).

There are usages for each of the frameworks in the [`Router` API reference](/sdk/api/router#frameworks).

```ts
import { env } from 'cloudflare:workers'
import { Router, Route } from 'porto/server'

export default Router({ basePath: '/porto' })
  .route('/merchant', Route.merchant({
    address: env.MERCHANT_ADDRESS as `0x${string}`,
    key: env.MERCHANT_PRIVATE_KEY as `0x${string}`,
    // Optionally handle which requests should be sponsored.
    // sponsor(request) {
    //   return true
    // },
  }),
) satisfies ExportedHandler<Env>
```

### Hook up API

Now that we have our Merchant API Route set up, we need to hook it up to our app.
We will do this by passing the URL to it on `Porto.create(){:js}`.

```ts
const porto = await Porto.create({
  merchantUrl: '/porto/merchant' // [!code focus]
})
```

:::note
If your server is at a different location to your app, you will need to pass the absolute URL
to it on `Porto.create(){:js}`.

```ts twoslash  
import { Porto } from 'porto'

const porto = await Porto.create({
  merchantUrl: 'https://myapi.com/porto/merchant' // [!code focus]
})
```

:::

### Done

That's it! Now you can start sponsoring calls for your users.

::::
